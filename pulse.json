name: Update Pulse Daily

on:
  schedule:
    - cron: "0 14 * * *"   # 6:00 AM PT (14:00 UTC). Change if needed.
  workflow_dispatch:       # allow manual run

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Node
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Install deps
        run: npm i dayjs

      - name: Generate today's pulse.json
        run: node .github/scripts/generate.js

      - name: Commit & push
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: daily pulse update"
          file_pattern: pulse.json
// Simple daily generator: pick 6 headlines from a pool and stamp the date.
const fs = require('fs');
const dayjs = require('dayjs');

const pool = JSON.parse(fs.readFileSync('data/pulse_pool.json','utf8'));

// Shuffle helper
function shuffle(arr){
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// Ensure at least 6 items exist
if (!Array.isArray(pool) || pool.length < 6) {
  console.error('Need at least 6 items in data/pulse_pool.json');
  process.exit(1);
}

// Pick 6 and write pulse.json
const picks = shuffle([...pool]).slice(0, 6).map(item => ({
  city: item.city,
  text: item.text
}));

// Optional: add date marker as a comment-like field (ignored by your site code)
const out = JSON.stringify(picks, null, 2);
fs.writeFileSync('pulse.json', out, 'utf8');

console.log(`Wrote pulse.json for ${dayjs().format('YYYY-MM-DD')}`);
[
  { "city": "Los Angeles", "text": "Inventory up 4% • Seller credits common on sub-$1M" },
  { "city": "Los Angeles", "text": "DOM down to 23 • Pricing bands tighten in NE LA" },
  { "city": "Orange County", "text": "Median ~$1.2M • Buyers favor 2-1 buydowns" },
  { "city": "Orange County", "text": "Coastal listings steady • South County new builds move" },
  { "city": "Riverside", "text": "Flip margins hold • Private money closes sub-10 days" },
  { "city": "Riverside", "text": "Entry-level SFRs bid fast • Appraisals lag" },
  { "city": "San Bernardino", "text": "Affordability draw • Multiple offers under $500k" },
  { "city": "San Diego", "text": "Luxury stable • North County days-to-close improves" },
  { "city": "Ventura", "text": "New listings tick up • Mid-range sees 2–3 offers" },
  { "city": "San Fernando Valley", "text": "Condos heat up • FHA mix rises" },
  { "city": "Inland Empire", "text": "Build-to-rent demand • Cap rates flatten" }
]
